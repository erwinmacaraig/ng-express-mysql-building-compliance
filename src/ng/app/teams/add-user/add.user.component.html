<div class="row">
	<div class="col m12 l12 s12 top-title-button">
		<h4 class="title left">
			Add New User
		</h4>
	</div>
</div>

<div class="row">
	<div class="col l12 m12 s12">

		<form #f="ngForm" >
			<table class="table striped">
				<thead>
					<tr>
						<th>First Name</th>
						<th>Last Name</th>
						<th>Email</th>
						<th>Account Role</th>
						<th>Location</th>
						<th>Mobile</th>
					</tr>
				</thead>
				<tbody>
					<tr *ngIf="addedUsers.length == 0">
						<td colspan="6">
							<h6 class="center">Add new user</h6>
						</td>
					</tr>
					<tr *ngFor="let user of addedUsers; let i = index">
						<td >
							<input type="text" [(ngModel)]="user.first_name" class="first-name" placeholder="First name" name="first_name{{i}}" required>
						</td>
						<td >
							<input type="text" [(ngModel)]="user.last_name" placeholder="Last name" name="last_name{{i}}" required>
						</td>
						<td style="position: relative;">
							<div *ngIf="user.errors.email_taken || user.errors.blacklisted"  style=" position: absolute; right: 5px; top: 5px; background-color: #f44336; padding: 1% 3%; color: #fff; border-radius: 5px;">
								<span *ngIf="user.errors.email_taken">Email is taken</span>
								<span *ngIf="user.errors.blacklisted">Invalid email</span>
							</div>
							<input type="text" [(ngModel)]="user.email" placeholder="Email" name="email{{i}}" required>
						</td>
						<td >
							
							<select required [(ngModel)]="user.account_role_id" name="accountRole{{i}}" (change)="onSelectedAccountRole(i)">
								<option value="0" selected>Select Account Role</option>
								<option *ngFor="let role of accountRoles" [value]="role.role_id"> {{ role.role_name }}</option>
							</select>
						</td>
						<td > 
							<a href="javascript:void(0)" [class.disabled]="user.account_role_id == 0" class="blue-text" (click)="showLocationSelection(user)"> {{user.location_name}} </a> 
						</td>
						<td class="with-remove">
							<input type="text" [(ngModel)]="user.mobile_number" placeholder="Mobile number" name="mobile{{i}}">
							<a href="javascript:void(0)" class="remove" (click)="removeAddedUser(i)">X</a>
						</td>
					</tr>
				</tbody>
				<tfoot>
					<tr>
						<td colspan="7">
							<button class="btn blue" (click)="addMoreRow()">
								+ Add more row
							</button>
						</td>
					</tr>
				</tfoot>
			</table>
		</form>

	<div class="col l12 m12 s12 button-container right-align">
		<button class="btn grey lighten-1 waves-effect waves-light cancel" [routerLink]="['/teams/all-users']" [disabled]="showLoadingButton"> Cancel </button>
		<button class="btn orange waves-effect waves-light" (click)="submitUsers(f)" *ngIf="!showLoadingButton"> Submit </button>
		
		<button class="btn orange waves-effect waves-light disabled center" *ngIf="showLoadingButton">
			<div class="preloader-wrapper active" style="width: 20px; height: 20px; margin-top: 10px;">
				<div class="spinner-layer spinner-red-only">
					<div class="circle-clipper left">
						<div class="circle"></div>
					</div><div class="gap-patch">
						<div class="circle"></div>
					</div><div class="circle-clipper right">
						<div class="circle"></div>
					</div>
				</div>
			</div>
		</button>
	</div>
</div>


<div id="modalLocations" class="modal modal-sublocations">
	
	

	<div class="modal-content">
		<h5>Select Location</h5>
		
		<div class="search-container" >
			<div class="input-container">
				<input type="text" placeholder="Search Level" >
			</div>
			<div class="icon-container">
				<img src="assets/images/locations/search_icon.png" alt="">
			</div>
		</div>
		
		<form #formLoc="ngForm" (submit)="submitSelectLocationModal(formLoc, $event)">

		<div class="list-region" style="overflow-y: auto; height: 340px;">
			<ul>
				<ng-template #recursiveList let-locations>
					<li *ngFor="let location of locations" class="list-division" [id]="location.location_id">
						<div class="name-radio-plus">
							<div class="input">
								<input ngModel required type="radio" name="selectLocation" [value]="location.location_id" [id]="'check-'+location.location_id" [ngClass]="{ hide : location.sublocations.length > 0 }" >
								<label [for]="'check-'+location.location_id" [ngClass]="{ hide : location.sublocations.length > 0 }"></label>
								<div class="plus-minus">
									<input type="checkbox" (change)="onChangeDropDown($event)" [ngClass]="{ hide : location.sublocations.length == 0 }" />
									<span class="sign" [ngClass]="{ hide : location.sublocations.length == 0 }" ></span>
									<span>{{location.name}}</span>
								</div>
							</div>
						</div>
						<ul *ngIf="location.sublocations.length > 0">
					        <ng-container *ngTemplateOutlet="recursiveList; context:{ $implicit: location.sublocations }"></ng-container>
						</ul>
					</li>
				</ng-template>
				<ng-container *ngTemplateOutlet="recursiveList; context:{ $implicit: locations }"></ng-container>
    		</ul>
		</div>

		<div class="button-container center">
			<a class="btn grey lighten-1 waves-effect waves-light" (click)="cancelLocationModal()"> Cancel </a>
			<button type="submit" class="btn orange waves-effect waves-light" [disabled]="!formLoc.valid"> Submit </button>
		</div>

		</form>

	</div>
</div>